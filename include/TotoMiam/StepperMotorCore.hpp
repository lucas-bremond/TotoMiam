////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/// @project                    Toto|Miam
/// @file                       TotoMiam/StepperMotorCore.hpp
/// @author                     Lucas Br√©mond <lucas.bremond@gmail.com>
/// @license                    MIT License

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#ifndef __TotoMiam_StepperMotorCore__
#define __TotoMiam_StepperMotorCore__

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include <TotoMiam/StepperMotor.hpp>
#include <TotoMiam/Angle.hpp>

#include <HardwareTimer.h>
#include <SmingCore.h>

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace totomiam
{

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

class StepperMotorController ;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

class StepperMotorCore
{

    public:

                                StepperMotorCore                            ( ) ;

                                StepperMotorCore                            (   const   StepperMotorCore&           aStepperMotorCore                           ) = delete ;

        virtual                 ~StepperMotorCore                           ( ) ;

        StepperMotorCore&       operator =                                  (   const   StepperMotorCore&           aStepperMotorCore                           ) = delete ;

        bool                    hasChannel                                  (           StepperMotorController&     aStepperMotorController                     ) const ;
        bool                    isChannelBusy                               (   const   StepperMotorController&     aStepperMotorController                     ) const ;

        void                    start                                       ( ) ;
        void                    stop                                        ( ) ;

        void                    addChannel                                  (           StepperMotorController&     aStepperMotorController                     ) ;
        void                    removeChannel                               (           StepperMotorController&     aStepperMotorController                     ) ;

        void                    rotate                                      (   const   Angle&                      anAngle,
                                                                                        StepperMotorController&     aStepperMotorController                     ) ;

    private:

        Vector<StepperMotorController*> channels_ ;

        HardwareTimer           hardwareTimer_ ;

} ;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

extern StepperMotorCore         stepperMotorCore ;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#endif

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
